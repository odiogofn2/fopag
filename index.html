<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro</title>
<link rel="icon" href="/favicon.ico">

<style>
body {
  font-family: Arial, sans-serif;
  background: #1e3c72;
  padding: 20px;
}
.container {
  max-width: 720px;
  margin: auto;
}
h1 {
  text-align: center;
  color: #fff;
}
.card {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
}
.saldo {
  font-size: 22px;
  text-align: center;
  font-weight: bold;
}
label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
}
input, select, button {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
}
button {
  background: #2a5298;
  color: #fff;
  border: none;
  cursor: pointer;
}
button:hover { opacity: .9; }

.erro {
  background: #f8d7da;
  color: #721c24;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 10px;
  display: none;
}

.lancamento {
  border-left: 5px solid;
  padding: 10px;
  margin-bottom: 10px;
}
.entrada { border-color: green; }
.saida { border-color: red; }

.acoes {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}
.acoes button {
  font-size: 12px;
}
</style>
</head>

<body>
<div class="container">

<h1>üí∞ Controle Financeiro</h1>

<div class="card">
  <div class="saldo" id="saldo">Saldo: R$ 0,00</div>
</div>

<div class="card">
  <div class="erro" id="msgErro"></div>

  <input type="hidden" id="editandoId">

  <label>Tipo</label>
  <select id="tipo">
    <option value="entrada">Entrada</option>
    <option value="saida">Sa√≠da</option>
  </select>

  <label>Valor (ex: 5,99 ou 6.99)</label>
  <input type="text" id="valor">

  <label>Descri√ß√£o</label>
  <input type="text" id="descricao">

  <label>Local</label>
  <input type="text" id="local">

  <button id="btnSalvar">Salvar</button>
</div>

<div class="card">
  <h3>Lan√ßamentos</h3>
  <div id="lista"></div>
</div>

</div>

<script>
/* ===== ESTADO ===== */
let lancamentos = JSON.parse(localStorage.getItem("lancamentos")) || [];

/* ===== DOM ===== */
const tipoInput = document.getElementById("tipo");
const valorInput = document.getElementById("valor");
const descricaoInput = document.getElementById("descricao");
const localInput = document.getElementById("local");
const editandoIdInput = document.getElementById("editandoId");
const lista = document.getElementById("lista");
const saldoEl = document.getElementById("saldo");
const btnSalvar = document.getElementById("btnSalvar");
const msgErro = document.getElementById("msgErro");

/* ===== UTIL ===== */
function mostrarErro(msg) {
  msgErro.innerText = msg;
  msgErro.style.display = "block";
}

function limparErro() {
  msgErro.style.display = "none";
}

function parseValor(valorTexto) {
  if (!valorTexto) return NaN;
  return parseFloat(valorTexto.replace(",", "."));
}

function formatar(valor) {
  return valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

function gerarId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

function salvarStorage() {
  localStorage.setItem("lancamentos", JSON.stringify(lancamentos));
}

function limparFormulario() {
  tipoInput.value = "entrada";
  valorInput.value = "";
  descricaoInput.value = "";
  localInput.value = "";
  editandoIdInput.value = "";
  btnSalvar.innerText = "Salvar";
}

/* ===== EVENTOS ===== */
btnSalvar.addEventListener("click", () => {
  limparErro();

  const tipo = tipoInput.value;
  const valor = parseValor(valorInput.value);
  const descricao = descricaoInput.value.trim();
  const local = localInput.value.trim();
  const editandoId = editandoIdInput.value;

  if (isNaN(valor) || valor <= 0) {
    mostrarErro("Informe um valor v√°lido. Ex: 5,99 ou 6.99");
    return;
  }

  if (!descricao || !local) {
    mostrarErro("Descri√ß√£o e Local s√£o obrigat√≥rios.");
    return;
  }

  if (editandoId) {
    const l = lancamentos.find(x => x.id === editandoId);
    if (!l) return;

    l.tipo = tipo;
    l.valor = valor;
    l.descricao = descricao;
    l.local = local;
  } else {
    lancamentos.unshift({
      id: gerarId(),
      tipo,
      valor,
      descricao,
      local,
      data: new Date().toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" }),

      // BASE PARA PARCELAS
      parcelado: false,
      totalParcelas: 1,
      parcelaAtual: 1,
      grupoParcelamentoId: null
    });
  }

  salvarStorage();
  atualizarTela();
  limparFormulario();
});

/* ===== CRUD ===== */
function editar(id) {
  const l = lancamentos.find(x => x.id === id);
  if (!l) return;

  tipoInput.value = l.tipo;
  valorInput.value = l.valor.toString().replace(".", ",");
  descricaoInput.value = l.descricao;
  localInput.value = l.local;
  editandoIdInput.value = l.id;
  btnSalvar.innerText = "Atualizar";
}

function excluir(id) {
  if (!confirm("Deseja excluir este lan√ßamento?")) return;
  lancamentos = lancamentos.filter(l => l.id !== id);
  salvarStorage();
  atualizarTela();
}

/* ===== UI ===== */
function atualizarTela() {
  lista.innerHTML = "";
  let saldo = 0;

  lancamentos.forEach(l => {
    saldo += l.tipo === "entrada" ? l.valor : -l.valor;

    const div = document.createElement("div");
    div.className = `lancamento ${l.tipo}`;
    div.innerHTML = `
      <strong>${l.descricao}</strong><br>
      Local: ${l.local}<br>
      ${l.data}<br>
      ${l.tipo === "entrada" ? "+" : "-"} ${formatar(l.valor)}
      <div class="acoes">
        <button onclick="editar('${l.id}')">‚úèÔ∏è Editar</button>
        <button onclick="excluir('${l.id}')">üóë Excluir</button>
      </div>
    `;
    lista.appendChild(div);
  });

  saldoEl.innerText = "Saldo: " + formatar(saldo);
}

/* INIT */
atualizarTela();
</script>

</body>
</html>
