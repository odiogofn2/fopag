<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg:#f1f3f6;
  --white:#ffffff;
  --border:#e0e0e0;
  --text:#2c3e50;
  --muted:#7f8c8d;
}

* { box-sizing:border-box; }

body {
 margin:0;
 font-family:'Segoe UI', Arial;
 background:var(--bg);
 color:var(--text);
}

.container {
 width:92%;
 max-width:1100px;
 margin:15px auto;
}

header {
 font-size:22px;
 font-weight:600;
 margin:10px 0;
}

/* ABAS */
.tabs {
 display:flex;
 gap:4px;
}

.tab {
 padding:8px 12px;
 background:#e9ecf0;
 cursor:pointer;
 border-radius:10px 10px 0 0;
 font-size:14px;
}

.tab.active {
 background:var(--white);
 border:1px solid var(--border);
 border-bottom:none;
 font-weight:bold;
}

.tabcontent {
 display:none;
 background:var(--white);
 padding:12px;
 border-radius:0 10px 10px 10px;
 border:1px solid var(--border);
 box-shadow:0 2px 6px rgba(0,0,0,.06);
 margin-bottom:10px;
}

.tabcontent.active { display:block; }

.card {
 background:var(--white);
 padding:10px;
 margin:6px 0;
 border-radius:14px;
 border:1px solid var(--border);
}

.row { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.filtros { display:grid; grid-template-columns:1fr 1fr 1fr; gap:6px; }

input,select {
 padding:8px;
 border:1px solid var(--border);
 border-radius:10px;
 margin-bottom:6px;
}

button {
 padding:8px;
 border:none;
 border-radius:10px;
 cursor:pointer;
 font-weight:bold;
}

table {
 width:100%;
 border-collapse:collapse;
}

th,td {
 border:1px solid var(--border);
 padding:6px;
 font-size:13px;
}
</style>
</head>

<body>
<div class="container">

<header>üí∞ Controle das Minhas Finan√ßas</header>

<div class="tabs">
 <div class="tab active" onclick="abrirTab(0)">Carteiras</div>
 <div class="tab" onclick="abrirTab(1)">Pessoas</div>
 <div class="tab" onclick="abrirTab(2)">Movimenta√ß√£o</div>
 <div class="tab" onclick="abrirTab(3)">Relat√≥rios</div>
</div>

<!-- ============ CARTEIRAS ============ -->
<div class="tabcontent active">

<h3>Minhas Carteiras</h3>
<div id="listaCarteiras"></div>

<h4>Nova carteira</h4>
<input id="nomeCarteira" placeholder="Nome da carteira">

<div class="row">
 <input id="saldoCarteira" placeholder="Saldo inicial" type="number">

 <select id="tipoCarteira">
  <option value="conta_bancobb">Banco do Brasil</option>
  <option value="conta_caixa">Caixa</option>
  <option value="banca_bet365">Bet365</option>
  <option value="dinheiro">Carteira em dinheiro</option>
  <option value="cartao_nubank">Cart√£o Nubank</option>
  <option value="poupanca">Poupan√ßa</option>
  <option value="trabalho">Trabalho</option>
 </select>
</div>

<div class="filtros">
 <input id="limitePix" placeholder="Limite PIX" type="number">
 <input id="limiteDinheiro" placeholder="Limite Dinheiro" type="number">
 <input id="limiteCartao" placeholder="Limite Cart√£o" type="number">
</div>

<button onclick="criarCarteira()">Cadastrar carteira</button>
</div>

<!-- ============ PESSOAS ============ -->
<div class="tabcontent">

<h3>Pessoas</h3>
<div id="listaPessoas"></div>

<input id="nomePessoa" placeholder="Nome da pessoa">

<select id="tipoPessoa">
 <option value="amigo">Amigo</option>
 <option value="familia">Fam√≠lia</option>
 <option value="cliente">Cliente</option>
 <option value="outros">Outros</option>
</select>

<button onclick="criarPessoa()">Cadastrar pessoa</button>
</div>

<!-- ============ MOVIMENTA√á√ÉO ============ -->
<div class="tabcontent">

<h3>Nova Movimenta√ß√£o</h3>

<input id="data" type="date"/>
<input id="onde" placeholder="Onde foi"/>
<input id="oque" placeholder="Descri√ß√£o"/>
<input id="valor" type="number"/>

<select id="carteira"></select>

<select id="forma_pag">
 <option value="pix">PIX</option>
 <option value="cartao">Cart√£o</option>
 <option value="dinheiro">Dinheiro</option>
</select>

<div class="row">
 <select id="avista">
  <option value="true">√Ä vista</option>
  <option value="false">Parcelado</option>
 </select>

 <input id="parcelas" type="number" value="1"/>
</div>

<select id="so_meu">
 <option value="true">Somente meu</option>
 <option value="false">Dividir com algu√©m</option>
</select>

<select id="dividido_com"></select>

<select id="outra_pessoa">
 <option value="false">N√£o</option>
 <option value="true">Despesa de outra pessoa</option>
</select>

<button onclick="salvarMov()">Salvar</button>

</div>

<!-- ============ RELAT√ìRIOS ============ -->
<div class="tabcontent">

<h3>Relat√≥rio Geral</h3>

<div class="filtros">
 <input id="mesFiltro" placeholder="M√™s" type="number">
 <input id="anoFiltro" placeholder="Ano" type="number">
 <select id="carteiraFiltro"></select>
</div>

<button onclick="carregarMov()">Filtrar</button>

<table>
<thead>
<tr>
 <th>Data</th>
 <th>Onde</th>
 <th>Descri√ß√£o</th>
 <th>Valor</th>
 <th>Pagamento</th>
 <th>Carteira</th>
</tr>
</thead>

<tbody id="lista"></tbody>
</table>

</div>

<script>
// ===== ABAS =====
function abrirTab(i){
 document.querySelectorAll('.tab').forEach((t,idx)=>
   t.classList.toggle('active', idx===i));

 document.querySelectorAll('.tabcontent').forEach((c,idx)=>
   c.classList.toggle('active', idx===i));
}

// ===== SUPABASE =====
const SUPABASE_URL = "https://kkecunfjxflmetsqczrt.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrZWN1bmZqeGZsbWV0c3FjenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NzMzNTEsImV4cCI6MjA4MzI0OTM1MX0.bzOf9CfUlMRYItyOV_e7w42vsbudaAQSF7cZUCUTE_A";

const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ===== PESSOAS =====
async function criarPessoa(){
 await db.from("pessoas").insert({
   nome: document.getElementById("nomePessoa").value,
   tipo: document.getElementById("tipoPessoa").value
 });

 document.getElementById("nomePessoa").value="";
 carregarPessoas();
}

async function carregarPessoas(){

 const {data} = await db.from("pessoas").select("*");

 document.getElementById("listaPessoas").innerHTML =
  data.map(p=> `<div class='card'>${p.nome} ‚Äì ${p.tipo}</div>`).join("");

 const opt =
  data.map(p=> `<option value='${p.id}'>${p.nome}</option>`).join("");

 document.getElementById("dividido_com").innerHTML = opt;
 document.getElementById("pessoaRateio") &&
   (document.getElementById("pessoaRateio").innerHTML = opt);

 document.getElementById("outraPessoa") &&
   (document.getElementById("outraPessoa").innerHTML =
      "<option value=''>Despesa s√≥ minha</option>"+opt);

 carregarCarteirasSelect();
}

// ===== CARTEIRAS =====
async function criarCarteira(){

 await db.from("carteiras").insert({
  nome:nomeCarteira.value,
  saldo:parseFloat(saldoCarteira.value||0),
  limite_pix:parseFloat(limitePix.value||0),
  limite_dinheiro:parseFloat(limiteDinheiro.value||0),
  limite_cartao:parseFloat(limiteCartao.value||0),
  tipo:tipoCarteira.value
 });

 nomeCarteira.value="";
 saldoCarteira.value="";
 carregarCarteiras();
}


async function carregarCarteiras(){

 const {data} = await db.from("carteiras").select("*");

 document.getElementById("listaCarteiras").innerHTML =
  data.map(c=> `<div class='card'>${c.nome}<br>Saldo: R$ ${c.saldo.toFixed(2)}</div>`).join("");

 const opt =
  data.map(c=> `<option value='${c.id}'>${c.nome}</option>`).join("");

 document.getElementById("carteiraFiltro").innerHTML = opt;
 document.getElementById("carteira").innerHTML = opt;
 document.getElementById("carteiraMov") &&
   (document.getElementById("carteiraMov").innerHTML = opt);
}

async function carregarCarteirasSelect(){
 const {data} = await db.from("carteiras").select("*");
 const opt = data.map(c=> `<option value='${c.id}'>${c.nome}</option>`).join("");
 document.getElementById("carteiraFiltro").innerHTML = opt;
}

// ===== SELECTS =====
async function carregarPessoasSelect(){
 const {data} = await db.from("pessoas").select("*");
 const opt = data.map(p=> `<option value='${p.id}'>${p.nome}</option>`).join("");
 document.getElementById("carteiraFiltro").innerHTML = opt;
}

// ===== MOVIMENTA√á√ïES =====
async function salvarMov(){

 const valor = parseFloat(document.getElementById("valor").value||0);

 const obj = {
  data: document.getElementById("data").value,
  onde: document.getElementById("onde").value,
  oque: document.getElementById("oque").value,
  valor,

  avista: document.getElementById("avista").value==="true",
  parcelas: parseInt(document.getElementById("parcelas").value||1),

  so_meu: document.getElementById("so_meu").value==="true",
  dividido_com: document.getElementById("dividido_com").value||null,

  outra_pessoa: document.getElementById("outra_pessoa").value==="true",

  forma_pag: document.getElementById("forma_pag").value,
  carteira_id: document.getElementById("carteira").value||null,

  status:"aberto"
 };

 await db.from("movimentacoes").insert(obj);

 carregarMov();
}


async function carregarMov(){

 const {data,error} =
  await db.from("movimentacoes")
   .select("*, carteiras(nome)")
   .order("data",{ascending:false});

 if(error){
   console.log(error);
   return;
 }

 document.getElementById("lista").innerHTML =
 data.map(m=>
  `<tr>
    <td>${m.data}</td>
    <td>${m.onde}</td>
    <td>${m.oque}</td>
    <td>R$ ${m.valor.toFixed(2)}</td>
    <td>${m.carteiras?.nome||''}</td>
   </tr>`
 ).join("");

}

// ===== INIT =====
window.addEventListener("load", ()=>{
 carregarPessoas();
 carregarCarteiras();
 carregarMov();
});

</script>

</body>
</html>
