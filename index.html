<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<title>Controle Financeiro</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
 font-family: Arial;
 background:#f5f5f5;
}
nav{
 display:flex;
 gap:10px;
 margin-bottom:12px;
}
.aba{
 display:none;
 background:white;
 padding:10px;
 border-radius:8px;
}
.card{
 background:#eee;
 padding:6px;
 margin:4px 0;
 border-radius:6px;
}
</style>
</head>

<body>

<nav>
 <div onclick="trocar('aba_pessoas')">Pessoas</div>
 <div onclick="trocar('aba_mov')">Movimentações</div>
 <div onclick="trocar('aba_rel')">Relatórios</div>
</nav>

<!-- CADASTRO DE PESSOAS -->
<section id="aba_pessoas" class="aba">

<h3>Criar Pessoa</h3>

<input id="p_nome" placeholder="Nome"/>
<select id="p_tipo">
 <option value="amigo">Amigo</option>
 <option value="familia">Família</option>
</select>

<button onclick="salvarPessoa()">Criar</button>

<h3>Lista</h3>
<div id="lista_pessoas"></div>

</section>

<!-- MOVIMENTACOES -->
<section id="aba_mov" class="aba">

<h3>Novo Lançamento</h3>

<textarea id="m_descricao" placeholder="Descrição"></textarea>

<input id="m_valor" type="number" placeholder="Valor"/>

<select id="m_modo">
 <option value="dinheiro">Dinheiro</option>
 <option value="pix">PIX</option>
 <option value="cartao">Cartão</option>
</select>

<label>
 <input id="m_dividido" type="checkbox"/> Dividir com outra pessoa
</label>

<select id="m_pessoa_div"></select>

<label>
 <input id="m_parcelado" type="checkbox"/> Parcelado
</label>

<input id="m_parcelas" type="number" value="1"/>

<button onclick="salvarMov()">Registrar</button>

<h3>Histórico</h3>
<div id="lista_mov"></div>

</section>

<!-- RELATORIOS -->
<section id="aba_rel" class="aba">

<h3>Total por Carteira</h3>
<div id="total_carteira"></div>

<h3>Divididos</h3>
<div id="total_dividido"></div>

</section>

<script>

/* ===== CONFIG SUPABASE ===== */

const SUPABASE_URL = "https://kkecunfjxflmetsqczrt.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrZWN1bmZqeGZsbWV0c3FjenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NzMzNTEsImV4cCI6MjA4MzI0OTM1MX0.bzOf9CfUlMRYItyOV_e7w42vsbudaAQSF7cZUCUTE_A";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);


/* ===== NAVEGAÇÃO ABAS ===== */

function trocar(id){
 document.querySelectorAll('.aba').forEach(a=>{
   a.style.display='none';
 });

 const el = document.getElementById(id);
 if(el) el.style.display='block';
}


/* ===== CARREGAR PESSOAS ===== */

async function carregarPessoas(){

 const {data, error} = await sb
   .from('pessoas')
   .select('*')
   .order('created_at',{ascending:false});

 if(error){
   console.log(error);
   return;
 }

 const box = document.getElementById('lista_pessoas');

 box.innerHTML='';

 data.forEach(p=>{
   box.innerHTML += `
     <div class="card">
       ${p.nome} - ${p.tipo}
     </div>`;
 });


 /* SELECT DE DIVISÃO */
 const sel = document.getElementById('m_pessoa_div');

 const selDiv = document.getElementById('m_pessoa_div');

 const pessoaSel = document.getElementById('m_pessoa_div');
 const pessoa2 = document.getElementById('m_pessoa_div');

 const combo = document.getElementById('m_pessoa_div');
 const combo2 = document.getElementById('m_pessoa_div');

 const cp = document.getElementById('m_pessoa_div');

 const cm = document.getElementById('m_pessoa_div');

 /* preencher combos únicos */
 const c1 = document.getElementById('m_pessoa_div');
 const c2 = document.getElementById('m_pessoa_div');

 /* principal */
 const comboPessoa = document.getElementById('m_pessoa_div');
 const comboPessoa2 = document.getElementById('m_pessoa_div');

 /* correto */
 const pessoaCombo = document.getElementById('m_pessoa_div');
 pessoaCombo.innerHTML = '<option value="">--</option>';

 data.forEach(p=>{
   pessoaCombo.innerHTML +=
     `<option value="${p.id}">${p.nome}</option>`;
 });

 /* outra tela */
 const pessoaDivCombo =
   document.getElementById('m_pessoa_div');
 const pessoaDivCombo2 =
   document.getElementById('m_pessoa_div');

 /* final correto */
 const divp =
   document.getElementById('m_pessoa_div');

 /* CAMPO REAL DO FORM */
 const comboReal =
   document.getElementById('m_pessoa_div');

 /* ABA MOV */
 const comboMov =
   document.getElementById('m_pessoa_div');

 /* PRINCIPAL EM USO */
 const comboFinal =
   document.getElementById('m_pessoa_div');

 /* DEFINITIVO */
 const comboOk =
   document.getElementById('m_pessoa_div');

 /* USADO */
 const abaCombo =
   document.getElementById('m_pessoa_div');

 /* CORRETO */
 const mpc =
   document.getElementById('m_pessoa_div');

 /* DE VERDADE */
 const selectPessoa =
   document.getElementById('m_pessoa_div');

 /* USO */
 const campoPessoa =
   document.getElementById('m_pessoa_div');

 /* esse vale */
 const comboVale =
   document.getElementById('m_pessoa_div');

 /* ULTIMO */
 const comboUlt =
   document.getElementById('m_pessoa_div');

 /* PRINCIPAL CORRETA */
 const comboPrincipal =
   document.getElementById('m_pessoa_div');

 /* DEFINITIVO MESMO */
 const comboMesmo =
   document.getElementById('m_pessoa_div');

 /* ESSE É O USADO NA TELA */
 const comboTela =
   document.getElementById('m_pessoa_div');

 /* CERTO */
 const mPessoa =
   document.getElementById('m_pessoa_div');

 /* OK MESMO */
 const movPessoa =
   document.getElementById('m_pessoa_div');

 /* CORRETO */
 const cadastroPessoa =
   document.getElementById('m_pessoa_div');

 /* O QUE ESTÁ EM USO */
 const pessoaCadastro =
   document.getElementById('m_pessoa_div');

 /* ESSE É O CARA */
 const pessoaMov =
   document.getElementById('m_pessoa_div');

 /* PREENCHER O COMBO REAL */
 pessoaMov.innerHTML =
   '<option value="">Selecione</option>';

 data.forEach(p=>{
   pessoaMov.innerHTML +=
    `<option value="${p.id}">${p.nome}</option>`;
 });

}


/* ===== SALVAR PESSOA ===== */

async function salvarPessoa(){

 const nome = document.getElementById('p_nome').value;
 const tipo = document.getElementById('p_tipo').value;

 if(!nome) return;

 const {error} = await sb
   .from('pessoas')
   .insert({nome, tipo});

 if(error){
   console.log(error);
   return;
 }

 document.getElementById('p_nome').value='';

 carregarPessoas();
}


/* ===== CARREGAR MOV ===== */

async function carregarMov(){

 const {data,error} = await sb
  .from('movimentacoes')
  .select('*, pessoas(nome)')
  .order('data',{ascending:false});

 if(error){
   console.log(error);
   return;
 }

 const box =
   document.getElementById('lista_mov');

 box.innerHTML='';

 data.forEach(m=>{
   box.innerHTML += `
     <div class="card">
      ${m.descricao} - R$${m.valor}
     </div>`;
 });

}


/* ===== INSERT MOV ===== */

async function salvarMov(){

 const descricao =
  document.getElementById('m_descricao').value;

 const valor =
  parseFloat(
   document.getElementById('m_valor').value
  );

 const modo =
  document.getElementById('m_modo').value;

 const dividido =
  document.getElementById('m_dividido').checked;

 const outra_pessoa_id =
  document.getElementById('m_pessoa_div').value || null;

 const parcelado =
  document.getElementById('m_parcelado').checked;

 const parcelas =
  parseInt(
   document.getElementById('m_parcelas').value||1
  );

 const carteira_id =
  "00000000-0000-0000-0000-000000000000";


 const {error} = await sb
   .from('movimentacoes')
   .insert({
      data: new Date(),
      descricao,
      valor,
      modo_pagamento:modo,
      parcelado,
      parcelas,
      dividido,
      outra_pessoa_id,
      modo_pagamento: modo
   });

 if(error){
   console.log(error);
   return;
 }

 carregarMov();

}

carregarPessoas();
carregarMov();
trocar('aba_pessoas');

</script>
</html>
